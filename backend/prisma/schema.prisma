// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Auth & Users
model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      String   @default("user")
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  expenses      Expense[]
  journalEntries JournalEntry[]
}

// Accounting: Chart of Accounts
model Account {
  id            String   @id @default(uuid())
  code          String   @unique
  name          String
  type          String   // asset, liability, equity, revenue, expense
  subType       String?
  normalBalance String   // debit, credit
  isActive      Boolean  @default(true)
  balance       Float    @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Relations
  journalDebits  JournalLine[] @relation("DebitAccount")
  journalCredits JournalLine[] @relation("CreditAccount")
  expenses       Expense[]
}

// Accounting: Journal Entries
model JournalEntry {
  id            String   @id @default(uuid())
  journalNumber String   @unique
  entryDate     DateTime
  reference     String?
  description   String?
  totalDebit    Float
  totalCredit   Float
  status        String   @default("draft") // draft, posted
  createdBy     String
  user          User     @relation(fields: [createdBy], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  lines         JournalLine[]
}

model JournalLine {
  id             String       @id @default(uuid())
  journalEntryId String
  journalEntry   JournalEntry @relation(fields: [journalEntryId], references: [id])
  debitAccountId String?
  debitAccount   Account?     @relation("DebitAccount", fields: [debitAccountId], references: [id])
  creditAccountId String?
  creditAccount  Account?     @relation("CreditAccount", fields: [creditAccountId], references: [id])
  amount         Float
  description    String?
}

// Accounting: Expenses
model Expense {
  id            String   @id @default(uuid())
  expenseNumber String   @unique
  expenseDate   DateTime
  category      String
  description   String
  amount        Float
  paymentMethod String
  status        String   @default("pending") // pending, approved, rejected
  accountId     String?
  account       Account? @relation(fields: [accountId], references: [id])
  approvedBy    String?
  user          User?    @relation(fields: [approvedBy], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  employeeId    String?
  employee      Employee? @relation(fields: [employeeId], references: [id])
}

// Accounting: Fixed Assets
model FixedAsset {
  id                      String   @id @default(uuid())
  assetNumber             String   @unique
  name                    String
  category                String
  purchaseDate            DateTime
  purchasePrice           Float
  salvageValue            Float
  usefulLife              Int      // in months
  depreciationMethod      String   // straight_line, etc.
  accumulatedDepreciation Float    @default(0)
  currentValue            Float
  status                  String   @default("active")
  location                String?
  serialNumber            String?
  createdAt               DateTime @default(now())
  updatedAt               DateTime @updatedAt
}

// Accounting: Budgets
model Budget {
  id             String   @id @default(uuid())
  fiscalYear     String
  department     String
  category       String
  budgetedAmount Float
  actualAmount   Float    @default(0)
  startDate      DateTime
  endDate        DateTime
  notes          String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// Accounting: Bank Accounts
model BankAccount {
  id             String   @id @default(uuid())
  accountName    String
  accountNumber  String
  bankName       String
  accountType    String   // checking, savings
  currency       String   @default("USD")
  openingBalance Float
  currentBalance Float
  status         String   @default("active")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// CRM: Contacts
model Contact {
  id          String   @id @default(uuid())
  firstName   String
  lastName    String
  email       String?
  phone       String?
  company     String?
  status      String   @default("lead")
  source      String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  deals       Deal[]
  activities  Activity[]
}

// CRM: Deals (Opportunities)
model Deal {
  id          String   @id @default(uuid())
  name        String
  value       Float
  stage       String
  probability Int      @default(0)
  contactId   String?
  contact     Contact? @relation(fields: [contactId], references: [id])
  expectedCloseDate DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  pipelineId  String?
  pipeline    Pipeline? @relation(fields: [pipelineId], references: [id])
}

// CRM: Leads (distinct from Contacts in this system)
model Lead {
  id          String   @id @default(uuid())
  name        String
  company     String?
  email       String?
  phone       String?
  source      String?
  status      String   @default("new")
  score       Int      @default(0)
  assignedTo  String?
  notes       String?
  tags        String[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  lastContact DateTime?
}

// CRM: Pipelines
model Pipeline {
  id          String   @id @default(uuid())
  name        String
  stages      String[]
  deals       Deal[]
}

// CRM: Activities
model Activity {
  id          String   @id @default(uuid())
  type        String   // call, email, meeting
  subject     String
  dueDate     DateTime?
  status      String   @default("pending") // pending, completed
  relatedTo   String?
  notes       String?
  
  contactId   String?
  contact     Contact? @relation(fields: [contactId], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ==================== ENHANCED ACCOUNTING MODELS ====================

// Credit Notes (Customer Returns/Adjustments)
model CreditNote {
  id                String   @id @default(uuid())
  creditNoteNumber  String   @unique
  customerId        String
  invoiceId         String?  // Original invoice if applicable
  issueDate         DateTime
  reason            String
  subtotal          Float
  taxAmount         Float    @default(0)
  totalAmount       Float
  status            String   @default("draft") // draft, issued, applied, void
  appliedAmount     Float    @default(0)
  notes             String?
  createdBy         String?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  items             CreditNoteItem[]
}

model CreditNoteItem {
  id              String     @id @default(uuid())
  creditNoteId    String
  creditNote      CreditNote @relation(fields: [creditNoteId], references: [id], onDelete: Cascade)
  productId       String?
  description     String
  quantity        Float
  unitPrice       Float
  taxRate         Float      @default(0)
  total           Float
}

// Debit Notes (Vendor Returns/Adjustments)
model DebitNote {
  id               String   @id @default(uuid())
  debitNoteNumber  String   @unique
  vendorId         String
  vendor           Vendor   @relation(fields: [vendorId], references: [id])
  billId           String?  // Original bill if applicable
  bill             Bill?    @relation(fields: [billId], references: [id])
  issueDate        DateTime
  reason           String
  subtotal         Float
  taxAmount        Float    @default(0)
  totalAmount      Float
  status           String   @default("draft") // draft, issued, applied, void
  appliedAmount    Float    @default(0)
  notes            String?
  createdBy        String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  items            DebitNoteItem[]
}

model DebitNoteItem {
  id            String    @id @default(uuid())
  debitNoteId   String
  debitNote     DebitNote @relation(fields: [debitNoteId], references: [id], onDelete: Cascade)
  productId     String?
  description   String
  quantity      Float
  unitPrice     Float
  taxRate       Float     @default(0)
  total         Float
}

// Bills (Vendor Invoices / Purchase Invoices)
model Bill {
  id              String   @id @default(uuid())
  billNumber      String   @unique
  vendorId        String
  vendor          Vendor   @relation(fields: [vendorId], references: [id])
  purchaseOrderId String?
  purchaseOrder   PurchaseOrder? @relation(fields: [purchaseOrderId], references: [id])
  grnId           String?
  grn             GRN?     @relation(fields: [grnId], references: [id])
  billDate        DateTime
  dueDate         DateTime
  subtotal        Float
  taxAmount       Float    @default(0)
  discountAmount  Float    @default(0)
  totalAmount     Float
  paidAmount      Float    @default(0)
  balance         Float
  status          String   @default("draft") // draft, pending, partial, paid, void
  paymentTerms    String?
  notes           String?
  createdBy       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  items           BillItem[]
  payments        BillPayment[]
  debitNotes      DebitNote[]
}

model BillItem {
  id          String  @id @default(uuid())
  billId      String
  bill        Bill    @relation(fields: [billId], references: [id], onDelete: Cascade)
  productId   String?
  description String
  quantity    Float
  unitPrice   Float
  taxRate     Float   @default(0)
  discount    Float   @default(0)
  total       Float
}

// Payments Received (from Customers)
model Payment {
  id              String   @id @default(uuid())
  paymentNumber   String   @unique
  customerId      String
  paymentDate     DateTime
  amount          Float
  paymentMode     String   // cash, bank_transfer, upi, card, cheque
  referenceNumber String?
  bankAccountId   String?
  depositTo       String?  // Account ID where money is deposited
  notes           String?
  status          String   @default("received") // received, deposited, void
  createdBy       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  applications    PaymentApplication[]
}

model PaymentApplication {
  id          String  @id @default(uuid())
  paymentId   String
  payment     Payment @relation(fields: [paymentId], references: [id], onDelete: Cascade)
  invoiceId   String
  amount      Float
  appliedAt   DateTime @default(now())
}

// Payments Made (to Vendors)
model BillPayment {
  id              String   @id @default(uuid())
  paymentNumber   String   @unique
  vendorId        String
  billId          String
  bill            Bill     @relation(fields: [billId], references: [id])
  paymentDate     DateTime
  amount          Float
  paymentMode     String
  referenceNumber String?
  bankAccountId   String?
  paidFrom        String?  // Account ID where money is paid from
  notes           String?
  status          String   @default("paid") // paid, void
  createdBy       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Receipts (Money Received - alternate to Payment for simpler tracking)
model Receipt {
  id              String   @id @default(uuid())
  receiptNumber   String   @unique
  receiptDate     DateTime
  receivedFrom    String   // Customer name or ID
  amount          Float
  paymentMode     String
  referenceNumber String?
  bankAccountId   String?
  accountId       String?  // Income/Revenue account
  description     String?
  status          String   @default("received")
  createdBy       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// Stock Journal (Inventory Adjustments)
model StockJournal {
  id              String   @id @default(uuid())
  journalNumber   String   @unique
  journalDate     DateTime
  journalType     String   // adjustment, transfer, write_off, opening
  warehouseFromId String?
  warehouseToId   String?
  reason          String
  reference       String?
  status          String   @default("draft") // draft, posted
  totalValue      Float    @default(0)
  createdBy       String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  items           StockJournalItem[]
}

model StockJournalItem {
  id              String       @id @default(uuid())
  stockJournalId  String
  stockJournal    StockJournal @relation(fields: [stockJournalId], references: [id], onDelete: Cascade)
  productId       String
  quantityIn      Float        @default(0)
  quantityOut     Float        @default(0)
  unitCost        Float
  totalValue      Float
  batchNumber     String?
  serialNumbers   String[]
  notes           String?
}

// Voucher Number Series (Auto-numbering like Tally)
model VoucherNumber {
  id          String   @id @default(uuid())
  voucherType String   @unique // invoice, credit_note, debit_note, payment, receipt, journal, bill, purchase_order, grn
  prefix      String
  separator   String   @default("/")
  fiscalYear  String   // e.g., "2025-26"
  nextNumber  Int      @default(1)
  format      String   @default("{prefix}{separator}{fiscalYear}{separator}{number}") // Template
  padding     Int      @default(4) // Zero-padding for number
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([voucherType, fiscalYear])
}

// Webhooks (for external integrations like QuickBooks)
model Webhook {
  id          String   @id @default(uuid())
  name        String
  event       String   // invoice.created, payment.received, bill.created, etc.
  targetUrl   String
  secret      String   // For HMAC signature verification
  headers     Json?    // Custom headers to send
  isActive    Boolean  @default(true)
  retryCount  Int      @default(3)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  logs        WebhookLog[]
}

model WebhookLog {
  id          String   @id @default(uuid())
  webhookId   String
  webhook     Webhook  @relation(fields: [webhookId], references: [id], onDelete: Cascade)
  event       String
  payload     Json
  response    String?
  statusCode  Int?
  success     Boolean  @default(false)
  errorMessage String?
  sentAt      DateTime @default(now())
  duration    Int?     // Response time in ms
}

// Audit Log (for compliance)
model AuditLog {
  id          String   @id @default(uuid())
  action      String   // create, update, delete, post, void
  entity      String   // invoice, bill, journal, etc.
  entityId    String
  userId      String?
  userName    String?
  changes     Json?    // Before/after values
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
}

// ==================== PURCHASE MODULE MODELS ====================

model Vendor {
  id            String   @id @default(uuid())
  vendorCode    String   @unique
  name          String
  contactPerson String?
  email         String?
  phone         String?
  address       String?
  country       String?
  type          String   @default("product") // product, service, consumable
  status        String   @default("active")
  paymentTerms  String?
  taxId         String?
  creditLimit   Float    @default(0)
  rating        Float    @default(0)
  notes         String?
  
  // Relations
  purchaseOrders PurchaseOrder[]
  bills          Bill[]
  debitNotes     DebitNote[]
  rfqs           RFQ[]
  grns           GRN[]
  evaluations    VendorEvaluation[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model PurchaseRequisition {
  id                String   @id @default(uuid())
  requisitionNumber String   @unique
  requestedBy       String
  department        String
  requestDate       DateTime
  requiredBy        DateTime
  totalEstimatedAmount Float
  justification     String?
  status            String   @default("pending") // pending, approved, rejected, ordered
  approvedBy        String?
  approvedDate      DateTime?
  
  items             PurchaseRequisitionItem[]
  purchaseOrders    PurchaseOrder[] // Can generate multiple POs

  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
}

model PurchaseRequisitionItem {
  id            String   @id @default(uuid())
  requisitionId String
  requisition   PurchaseRequisition @relation(fields: [requisitionId], references: [id], onDelete: Cascade)
  productId     String?
  name          String   // Keep name in case product not in DB
  quantity      Float
  estimatedPrice Float
  priority      String   @default("medium")
  status        String   @default("pending") // pending, ordered
}

model RFQ {
  id            String   @id @default(uuid())
  rfqNumber     String   @unique
  vendorId      String?  // Optional, if sent to specific vendor
  vendor        Vendor?  @relation(fields: [vendorId], references: [id])
  title         String
  description   String?
  issueDate     DateTime
  dueDate       DateTime
  status        String   @default("draft") // draft, sent, closed
  
  items         RFQItem[]
  quotes        VendorQuote[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model RFQItem {
  id             String   @id @default(uuid())
  rfqId          String
  rfq            RFQ      @relation(fields: [rfqId], references: [id], onDelete: Cascade)
  name           String
  quantity       Float
  unit           String?
  specifications String?
}

model VendorQuote {
  id          String   @id @default(uuid())
  rfqId       String
  rfq         RFQ      @relation(fields: [rfqId], references: [id], onDelete: Cascade)
  vendorName  String
  totalAmount Float
  validUntil  DateTime?
  status      String   @default("received") // received, accepted, rejected
  remarks     String?
}

model PurchaseOrder {
  id              String   @id @default(uuid())
  orderNumber     String   @unique
  vendorId        String
  vendor          Vendor   @relation(fields: [vendorId], references: [id])
  requisitionId   String?
  requisition     PurchaseRequisition? @relation(fields: [requisitionId], references: [id])
  orderDate       DateTime
  expectedDelivery DateTime?
  subtotal        Float
  taxAmount       Float    @default(0)
  discountAmount  Float    @default(0)
  shippingCost    Float    @default(0)
  totalAmount     Float
  currency        String   @default("USD")
  paymentTerms    String?
  status          String   @default("draft") // draft, issued, received, partial, closed, cancelled
  receivedStatus  String   @default("pending") // pending, partial, received
  billingStatus   String   @default("pending") // pending, partial, billed
  notes           String?
  
  items           PurchaseOrderItem[]
  grns            GRN[]
  bills           Bill[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model PurchaseOrderItem {
  id              String        @id @default(uuid())
  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  productId       String?
  name            String
  description     String?
  quantity        Float
  unitPrice       Float
  discount        Float         @default(0)
  taxRate         Float         @default(0)
  total           Float
  // IT Services / Subscription Fields
  startDate       DateTime?
  endDate         DateTime?
  period          String?       // monthly, yearly, one-time
  serviceType     String?       // saas, consulting, maintenance, hardware
  
  // Tracking fulfillment
  receivedQty     Float         @default(0)
  billedQty       Float         @default(0)
}

model GRN {
  id              String   @id @default(uuid())
  grnNumber       String   @unique
  purchaseOrderId String
  purchaseOrder   PurchaseOrder @relation(fields: [purchaseOrderId], references: [id])
  vendorId        String
  vendor          Vendor   @relation(fields: [vendorId], references: [id])
  receiptDate     DateTime
  receivedBy      String?
  notes           String?
  status          String   @default("completed") // pending, completed
  
  // IT Service Fields
  isServiceEntry  Boolean  @default(false)
  
  items           GRNItem[]
  bills           Bill[]

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

model GRNItem {
  id           String   @id @default(uuid())
  grnId        String
  grn          GRN      @relation(fields: [grnId], references: [id], onDelete: Cascade)
  productId    String?
  name         String
  orderedQty   Float
  receivedQty  Float
  rejectedQty  Float    @default(0)
  acceptedQty  Float
  reason       String? // Reason for rejection
  
  // Service entry specific
  serviceDate  DateTime?
  performedBy  String? // Consultant Name
}

model VendorEvaluation {
  id              String   @id @default(uuid())
  vendorId        String
  vendor          Vendor   @relation(fields: [vendorId], references: [id])
  evaluationPeriod String
  evaluationDate  DateTime
  evaluatedBy     String?
  overallScore    Float
  scores          Json     // Key-value pairs for criteria
  notes           String?
  recommendations String?
  status          String   @default("draft")

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ==================== HR MODULE MODELS ====================

model Department {
  id            String     @id @default(uuid())
  departmentName String    @unique
  headId        String?    // Employee ID of the head
  head          Employee?  @relation("DepartmentHead", fields: [headId], references: [id])
  parentDepartmentId String?
  parentDepartment Department? @relation("DepartmentHierarchy", fields: [parentDepartmentId], references: [id])
  childDepartments Department[] @relation("DepartmentHierarchy")
  
  description   String?
  budget        Float      @default(0)
  currency      String     @default("USD")
  
  employees     Employee[] @relation("EmployeeDepartment")
  
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
}

model Employee {
  id              String   @id @default(uuid())
  employeeId      String   @unique // Custom ID like EMP-2024-001
  firstName       String
  lastName        String
  email           String   @unique
  phone           String?
  
  // Job Details
  departmentId    String?
  department      Department? @relation("EmployeeDepartment", fields: [departmentId], references: [id])
  position        String
  employmentType  String   // full-time, part-time, contract, intern
  status          String   @default("active") // active, on-leave, terminated, resigned
  hireDate        DateTime
  probationEndDate DateTime?
  terminationDate DateTime?
  
  // Reporting Line
  managerId       String?
  manager         Employee? @relation("Manager", fields: [managerId], references: [id])
  directReports   Employee[] @relation("Manager")
  
  // Compensation
  salary          Float
  currency        String   @default("USD")
  bankAccount     String?
  bankName        String?
  taxId           String?
  
  // Personal Info
  dateOfBirth     DateTime?
  gender          String?
  nationality     String?
  address         String?
  emergencyContact Json?   // { name, phone, relation }
  
  // Relations
  departmentHeaded Department[] @relation("DepartmentHead")
  attendance       Attendance[]
  leaves           LeaveRequest[]
  payrolls         Payroll[]
  reviewsTo        PerformanceReview[] @relation("Reviewee")
  reviewsFrom      PerformanceReview[] @relation("Reviewer")
  expenses         Expense[]
  
  // Phase 1 Extensions
  timeEntries      TimeEntry[]
  assets           Asset[]
  
  // Auth Link (if they have login access)
  userId           String?  @unique
  // user          User?    @relation(fields: userId, references: id) // Uncomment if linking to User model directly

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  TrainingsEnrolled Training[]
}

model Attendance {
  id          String   @id @default(uuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  date        DateTime // Store date part mostly
  checkIn     DateTime?
  checkOut    DateTime?
  status      String   @default("present") // present, absent, late, half-day, on-leave
  workHours   Float    @default(0)
  overtime    Float    @default(0)
  notes       String?
  ipAddress   String?  // For geofencing validation if needed
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([employeeId, date]) // One record per employee per day
}

model LeaveRequest {
  id          String   @id @default(uuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  leaveType   String   // annual, sick, casual, maternity, unpaid
  startDate   DateTime
  endDate     DateTime
  totalDays   Float
  reason      String?
  status      String   @default("pending") // pending, approved, rejected
  approvedBy  String?  // Employee ID or User ID
  rejectionReason String?
  documents   String[] // URLs to uploaded medical certs etc.
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Payroll {
  id          String   @id @default(uuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  period      String   // e.g., "2024-01" or "Jan 2024"
  startPeriod DateTime
  endPeriod   DateTime
  
  // Earnings
  basicSalary Float
  allowances  Json?    // { hra: 1000, transport: 500 }
  overtimePay Float    @default(0)
  bonus       Float    @default(0)
  grossSalary Float
  
  // Deductions
  tax         Float    @default(0)
  insurance   Float    @default(0)
  pf          Float    @default(0) // Provident Fund
  loanRepayment Float  @default(0)
  totalDeductions Float
  
  netSalary   Float
  status      String   @default("draft") // draft, generated, paid
  paymentDate DateTime?
  paymentMethod String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@unique([employeeId, period])
}

model PerformanceReview {
  id          String   @id @default(uuid())
  revieweeId  String
  reviewee    Employee @relation("Reviewee", fields: [revieweeId], references: [id])
  reviewerId  String
  reviewer    Employee @relation("Reviewer", fields: [reviewerId], references: [id])
  
  period      String   // e.g., "Q4 2023", "2024 Annual"
  reviewDate  DateTime
  
  ratings     Json     // { productivity: 5, communication: 4, ... }
  goals       Json     // [{ goal: "...", status: "achieved" }]
  feedback    String?
  overallScore Float
  status      String   @default("draft") // draft, shared, acknowledged, final
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Training {
  id          String   @id @default(uuid())
  title       String
  description String?
  trainer     String?
  type        String   // internal, external, online
  startDate   DateTime
  endDate     DateTime
  durationHours Float
  cost        Float    @default(0)
  status      String   @default("scheduled") // scheduled, in-progress, completed, cancelled
  
  attendees   Employee[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Announcement {
  id          String   @id @default(uuid())
  title       String
  content     String
  authorId    String?  // UserId
  targetDepartments String[] // Array of Dept IDs or "ALL"
  priority    String   @default("normal") // low, normal, high, critical
  isActive    Boolean  @default(true)
  validUntil  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Modify Expense model to link to Employee optionally
// Note: Expense is defined earlier, we can't easily modify it in append mode without re-defining.
// For now, we will assume the relation can be added via a separate migration or manual edit if needed, 
// but since we are appending, we can't modify the existing Expense block above.
// However, we added `expenses Expense[]` to Employee model, which requires `employeeId` on Expense.
// ==================== PHASE 1: HR & CRM EXTENSIONS ====================

model TimeEntry {
  id          String   @id @default(uuid())
  employeeId  String
  employee    Employee @relation(fields: [employeeId], references: [id])
  projectId   String?  // Can link to a Project model later
  description String?
  startTime   DateTime
  endTime     DateTime?
  duration    Int?     // In minutes
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model JobPosting {
  id          String   @id @default(uuid())
  title       String
  department  String
  type        String   // Full-time, Part-time
  location    String   // Remote, On-site
  description String
  requirements String?
  status      String   @default("open") // open, closed, draft
  
  candidates  Candidate[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Candidate {
  id          String   @id @default(uuid())
  name        String
  email       String
  phone       String?
  resumeUrl   String?
  status      String   @default("applied") // applied, screening, interview, offer, hired, rejected
  
  jobPostingId String?
  jobPosting   JobPosting? @relation(fields: [jobPostingId], references: [id])
  
  rating      Int?
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model Asset {
  id           String   @id @default(uuid())
  assetNumber  String   @unique
  name         String
  type         String   // Laptop, Monitor, Phone, Furniture
  serialNumber String?
  purchaseDate DateTime?
  purchasePrice Float?
  value        Float?
  status       String   @default("in-stock") // in-stock, assigned, repair, retired
  
  assignedTo   String?
  employee     Employee? @relation(fields: [assignedTo], references: [id])
  
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model SalesScript {
  id          String   @id @default(uuid())
  title       String
  stage       String   // prospecting, discovery, closing, objection
  content     String   // Script body with placeholders
  tags        String[]
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

